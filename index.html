<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Sentence completion</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="./css/styles.css">
        <style></style>
    </head>

<body>
    <div id="container1">
        <images></images>
    </div>    
</body>

<script type="module">
    import {createApp} from '/js/vue.esm-browser.js'
    const app = createApp({})

    const images = {
        data() {
            return {
                dataImages:[
                    {
                        url: 'https://images.pexels.com/photos/7195269/pexels-photo-7195269.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
                        word: 'naranja',
                    },
                    {
                        url: 'https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
                        word: 'manzana',
                    },
                    {
                        url: 'https://images.pexels.com/photos/2872767/pexels-photo-2872767.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
                        word: 'banano',
                    },
                    {
                        url: 'https://images.pexels.com/photos/4033025/pexels-photo-4033025.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2',
                        word: 'mandarina',
                    },
                    {
                        url:'https://images.pexels.com/photos/15145653/pexels-photo-15145653.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
                        word:'fresas'
                    },
                    {
                        url:'https://images.pexels.com/photos/1098537/pexels-photo-1098537.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
                        word: 'uvas'
                    }
                ],
                words:[],
                images:[],
                arraySolution: [],
                draggedWord: false,
                isWordDropped: false,
                pairsResults: 0,
                counterTemporizador: 10, // Define el contador con el valor inicial
                messageTemporizador: "", // Define el mensaje
            }
        },
        template: `
            <div class="row">
                <div class="col-12 text-center">
                    <p>Contador: {{ formattedCounter }}</p>
                    <p>{{ messageTemporizador }}</p>
                </div>
            </div>

            <div class="container text-center">
                <div class="row content-words">
                    <div class="col-6 content-word">
                        <div v-for="(word, index) in words" :key="index" class="word"
                            draggable="true"
                            @dragstart="dragStartWord($event, word)"
                            @dragend="dragEndWord($event)"
                        >
                            {{word}} 
                        </div>
                    </div>
                </div>
            </div>

            <div class="container text-center">
                <div class="row content-images">
                    <div v-for="(image, index) in arraySolution" :key="index" class="col-3">
                        <div class="content-image">
                            <img 
                                draggable="false"
                                class="img-fluid same-size" 
                                :src="image.url"
                            />
                        </div>
                        <div class="col-3 drop-zone-words"
                            @drop="dropWord($event)"
                            @dragover="allowDropWord($event)"
                            :data-index="index"
                            >
                            <div v-if="arraySolution[index].word !== ''" class="word" > 
                                {{arraySolution[index].word}}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <button @click="deleteWordsArraySolution()" type="button" class="btn btn-danger">Eliminar seleccion</button>
                    </div>
                    <div class="col-6">
                        <button @click="pairsFound()" type="button" class="btn btn-success">Resultados</button>
                    </div>
                </div>
                --------------------------
                {{pairsResults}}
            </div>
        `,
        created(){
            this.getWords();
            this.createZoneDropArray();
        },
        watch:{
            counterTemporizador(newValue){
                if(newValue <= 0){
                    this.countdownFinished();
                    console.log('EVENT COUNTER OVERTIME');
                }
            }
        },
        mounted(){
            setInterval(() => {
                if (this.counterTemporizador > 0) {
                    this.counterTemporizador--;
                }
            }, 1000); // 1000 ms = 1 segundo  
        },
        methods: {
            getWords(){
                this.words = this.dataImages.map( data => data.word);
            },
            createZoneDropArray(){
                this.dataImages.forEach( element => {
                    this.arraySolution.push({
                        url: element.url,
                        word: ''
                    })
                })
            },
            dragStartWord(event, word){
                console.log('EVENT DRAG start');
                event.dataTransfer.setData('text/plain', word.toString());
            },
            dragEndWord(event){
                console.log('EVENT DRAG end');
            },
            allowDropWord(event){
                console.log('EVENT allow drop word');
                event.preventDefault();
            },
            dropWord(event){
                event.preventDefault();
                const word = event.dataTransfer.getData('text/plain');
                const targetIndex = event.target.getAttribute('data-index');

                const wordExists = this.arraySolution.find( element => element.word === word )
                if (!wordExists && this.arraySolution[targetIndex].word === ''){
                    this.arraySolution[targetIndex].word = word
                }
                console.log('EVENT DROP *********');
            },
            deleteWordsArraySolution(){
                this.arraySolution.forEach( element => {
                    element.word = ''
                })
            },
            pairsFound(){
                let count = 0
                this.arraySolution.forEach( element =>{
                    let indexWord = this.dataImages.findIndex( img => img.word === element.word );
                    if(this.dataImages[indexWord].url === element.url){
                        count = count + 1;
                        this.pairsResults = count
                    }
                })
            },
            countdownFinished() {
                this.messageTemporizador = "El tiempo termino.";
                this.arraySolution.forEach( element => {
                    if(element.word === ''){
                        element.word = 0
                    }
                })
            },
        },
        computed: {
            formattedCounter() {
                let minutes = Math.floor(this.counterTemporizador / 60);
                let seconds = this.counterTemporizador % 60;    
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
    }
    app.component('images', images)
    app.mount('#container1')

    app.config.errorHandler = (err) => {
        /* handle error */
        console.log('pump error', err);
    }
</script>


</html>